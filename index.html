<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<title>Ristisanaratkoja</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">
<style>
:root{
  --cell:52px;--gap:6px;--accent:#0d6efd;--bg:#f3f4f6;--ink:#0f172a;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  margin:0;background:var(--bg);color:var(--ink);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,sans-serif;
  display:flex;flex-direction:column;align-items:center;gap:16px;
  padding:max(env(safe-area-inset-top),20px) 16px 60px;
  touch-action:manipulation;
}
h1{margin:0;color:var(--accent);font-weight:700;}
#grid{
  display:flex;flex-wrap:wrap;justify-content:center;gap:var(--gap);
  max-width:calc(var(--cell)*15 + var(--gap)*14);
}
.cell{
  width:var(--cell);height:var(--cell);
  display:grid;place-items:center;
  border:2px solid #ccc;border-radius:8px;
  background:#fff;font-size:1.6rem;font-weight:700;
  text-transform:uppercase;color:#000;
  transition:.15s;border-color,.15s;background-color;
  user-select:none;cursor:pointer;
}
.cell.active{border-color:var(--accent);background:#eaf1ff;}
#buttons{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;}
button{padding:.65rem 1.2rem;font-weight:700;background:var(--accent);color:#fff;border:none;border-radius:8px;}
button:active{transform:scale(.97);}
#results{
  width:min(680px,94vw);max-height:60vh;overflow:auto;
  background:#fff;border-radius:10px;
  padding:12px 16px;box-shadow:0 2px 8px rgba(0,0,0,.15);
  font-family:ui-monospace,Menlo,Consolas,monospace;
  white-space:pre-wrap;
}
.known{color:var(--accent);font-weight:700;}
/* 3) Piiloinput varmemmin offscreeniin */
#iosInput{
  position:fixed; left:-9999px; top:0;
  width:1px; height:1px; opacity:0;
  border:none; background:transparent;
}

</style>
</head>
<body>
<h1>Ristisanaratkoja</h1>

<div id="grid"></div>
<input id="iosInput" type="text" inputmode="text" autocapitalize="characters" autocorrect="off" spellcheck="false">

<div id="buttons">
  <button id="clearBtn">üßπ Tyhjenn√§</button>
  <button id="searchBtn">üîç Etsi</button>

</div>

<pre id="results">Ladataan sanalistaa‚Ä¶</pre>

<script>
const results = document.getElementById('results');           // 1) HAE ELEMENTTI

const isiOS = (
  /iPad|iPhone|iPod/.test(navigator.platform) ||              // 2) KORJAA TUNNISTUS
  (navigator.userAgent.includes('Mac') && 'ontouchend' in document)
);

const iosInput = document.getElementById("iosInput");

// (valinnainen) tai k√§yt√§ laitetunnistusta:
// const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;


let words=[];
fetch("suodatetut.txt").then(r=>r.text()).then(t=>{
  words=t.split(/\r?\n/).map(w=>w.trim()).filter(Boolean);
  results.textContent="Versio 1.1 - Valmis! Napauta ruutua ja kirjoita.";
});

const CELLS=15,grid=document.getElementById("grid"),cells=[];
for(let i=0;i<CELLS;i++){
  const d=document.createElement("div");
  d.className="cell";grid.appendChild(d);cells.push(d);
}

let active=0;
function setActive(i){
  cells[active]?.classList.remove("active");
  active=i;cells[active].classList.add("active");
}
setActive(0);



// üîπ Klikkaus: aseta aktiivinen ja fokusoi kentt√§
grid.addEventListener("click",e=>{
  const cell=e.target.closest(".cell");if(!cell)return;
  const i=cells.indexOf(cell);setActive(i);
  if(isiOS) iosInput.focus();
});

// ---------- PC / Desktop sy√∂tt√∂ (t√§ysin alkuper√§inen) ----------
if(!isiOS){
  document.addEventListener("keydown",e=>{
    const k=e.key;
    if(k.length===1&&/[a-z√•√§√∂]/i.test(k)){
      cells[active].textContent=k.toUpperCase();
      setActive(Math.min(active+1,CELLS-1));
    }
    else if(k===" "){e.preventDefault();setActive(Math.min(active+1,CELLS-1));}
    else if(k==="."){cells[active].textContent=".";setActive(Math.min(active+1,CELLS-1));}
    else if(k==="Backspace"){e.preventDefault();cells[active].textContent="";setActive(Math.max(active-1,0));}
    else if(k==="ArrowRight")setActive(Math.min(active+1,CELLS-1));
    else if(k==="ArrowLeft") setActive(Math.max(active-1,0));
    else if(k==="Enter")findMatchesSmart();
    else if(k==="Escape")clearGrid();
  });
}

// ---------- iPad / iPhone sy√∂tt√∂ ----------
if(isiOS){
  iosInput.addEventListener("input",e=>{
    const val=e.target.value.toUpperCase();
    e.target.value="";
    if(!val)return;
    const k=val[val.length-1];
    if(/[A-Z√Ö√Ñ√ñ]/.test(k)){
      cells[active].textContent=k;
      setActive(Math.min(active+1,CELLS-1));
    }else if(k==="."){
      cells[active].textContent=".";
      setActive(Math.min(active+1,CELLS-1));
    }else if(k===" "){
      setActive(Math.min(active+1,CELLS-1));
    }
  });
  iosInput.addEventListener("keydown",e=>{
    if(e.key==="Backspace"){e.preventDefault();cells[active].textContent="";setActive(Math.max(active-1,0));}
    else if(e.key==="Enter"){e.preventDefault();findMatchesSmart();}
    else if(e.key==="Escape"){e.preventDefault();clearGrid();}
    else if(e.key==="ArrowRight")setActive(Math.min(active+1,CELLS-1));
    else if(e.key==="ArrowLeft") setActive(Math.max(active-1,0));
  });
}

function clearGrid(){cells.forEach(c=>c.textContent="");setActive(0);results.textContent="Ruudukko tyhjennetty.";}
document.getElementById("clearBtn").onclick=clearGrid;
document.getElementById("searchBtn").onclick=findMatchesSmart;

// ---------- Haku ----------
function findMatchesSmart(){
  const pattern=cells.map(c=>{
    const t=(c.textContent||"").trim().toUpperCase();
    if(t===".")return".";if(t==="")return"_";return t;
  });
  const maxLen=pattern.length,dotIdx=pattern.indexOf("."),matches=[];
  if(dotIdx!==-1){
    const cut=pattern.slice(0,dotIdx);
    const model=cut.map(ch=>ch==="_"?".":ch).join("");
    const re=new RegExp("^"+model+"$","i");
    const plen=cut.length;
    for(const w of words){if(w.length===plen&&re.test(w))matches.push([w.toUpperCase(),0]);}
  }else{
    const known=[];
    for(let i=0;i<maxLen;i++){const ch=pattern[i];if(/^[A-Z√Ö√Ñ√ñ]$/.test(ch))known.push([i,ch]);}
    if(!known.length){results.textContent="Sy√∂t√§ ainakin yksi kirjain.";return;}
    for(const wOrig of words){
      const w=wOrig.toUpperCase();const wlen=w.length;if(wlen>maxLen)continue;
      for(let start=0;start<=maxLen-wlen;start++){
        let fits=true;
        for(const [pos,ch] of known){
          const wi=pos-start;
          if(wi<0||wi>=wlen||w[wi]!==ch){fits=false;break;}
        }
        if(fits){matches.push([w,start]);break;}
      }
    }
  }
  if(!matches.length){results.textContent="Ei sopivia sanoja.";return;}
  let html=`<b>${matches.length}</b> sanaa l√∂ytyi:<br><br>`;
  for(const [word,start]of matches){
    let out="";
    for(let i=0;i<word.length;i++){
      const boardIndex=start+i;
      const boardCh=pattern[boardIndex];
      const wCh=word[i];
      if(boardIndex<maxLen&&/^[A-Z√Ö√Ñ√ñ]$/.test(boardCh)&&boardCh===wCh)
        out+=`<span class="known">${wCh}</span>`;
      else out+=wCh;
    }
    html+=out+"<br>";
  }
  results.innerHTML=html;
}
</script>
</body>
</html>
