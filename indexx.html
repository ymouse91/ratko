<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ristisanaratkoja</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">
<style>
:root{
  --cell:52px;
  --gap:6px;
  --accent:#0d6efd;
  --bg:#f3f4f6;
  --ink:#0f172a;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:16px;
  padding:max(env(safe-area-inset-top),20px) 16px 60px;
  touch-action:manipulation;
}
h1{
  margin:0;
  color:var(--accent);
  font-weight:700;
}
#grid{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:var(--gap);
  max-width:calc(var(--cell)*15 + var(--gap)*14);
}
.cell{
  width:var(--cell);
  height:var(--cell);
  display:grid;
  place-items:center;
  border:2px solid #ccc;
  border-radius:8px;
  background:#fff;
  font-size:1.6rem;
  font-weight:700;
  text-transform:uppercase;
  color:#000;
  transition:.15s border-color,.15s background-color;
  user-select:none;
}
.cell.active{
  border-color:var(--accent);
  background:#eaf1ff;
}
#buttons{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:center;
}
button{
  padding:.65rem 1.2rem;
  font-weight:700;
  background:var(--accent);
  color:#fff;
  border:none;
  border-radius:8px;
}
button:active{transform:scale(.97);}
#results{
  width:min(680px,94vw);
  max-height:60vh;
  overflow:auto;
  background:#fff;
  border-radius:10px;
  padding:12px 16px;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
  font-family:ui-monospace,Menlo,Consolas,monospace;
  white-space:pre-wrap;
}
.known{
  color:var(--accent);
  font-weight:700;
}
</style>
</head>
<body>
<h1>Ristisanaratkoja</h1>

<div id="grid"></div>

<div id="buttons">
  <button id="searchBtn">üîç Etsi</button>
  <button id="clearBtn">üßπ Tyhjenn√§</button>
</div>

<pre id="results">Ladataan sanalistaa‚Ä¶</pre>

<script>
let words=[];
fetch("suodatetut.txt").then(r=>r.text()).then(t=>{
  words=t.split(/\r?\n/).map(w=>w.trim()).filter(Boolean);
  results.textContent="Valmis! Napauta ruutua ja kirjoita.";
});

const CELLS=15;
const grid=document.getElementById("grid");
const cells=[];
for(let i=0;i<CELLS;i++){
  const d=document.createElement("div");
  d.className="cell";
  grid.appendChild(d);
  cells.push(d);
}

let active=0;
function setActive(i){
  cells[active]?.classList.remove("active");
  active=i;
  cells[active].classList.add("active");
}
setActive(0);

// iPad/iPhone yhteensopiva sy√∂tt√∂
grid.addEventListener("click",e=>{
  const cell=e.target.closest(".cell");
  if(!cell)return;
  const i=cells.indexOf(cell);
  setActive(i);

  const input=document.createElement("input");
  input.type="text";
  input.inputMode="text";
  input.autocapitalize="characters";
  input.maxLength=1;
  input.style.position="absolute";
  input.style.opacity=0;
  document.body.appendChild(input);
  input.focus();

  input.addEventListener("input",()=>{
    const ch=input.value.toUpperCase();
    if(ch==="."){cell.textContent=".";}
    else if(/[A-Z√Ö√Ñ√ñ]/.test(ch)){cell.textContent=ch;}
    setActive(Math.min(active+1,CELLS-1));
    input.remove();
  });

  input.addEventListener("keydown",ev=>{
    if(ev.key==="Backspace"){
      ev.preventDefault();
      cell.textContent="";
      setActive(Math.max(active-1,0));
    }
    else if(ev.key==="ArrowRight") setActive(Math.min(active+1,CELLS-1));
    else if(ev.key==="ArrowLeft")  setActive(Math.max(active-1,0));
    else if(ev.key==="Enter"){findMatchesSmart();input.remove();}
    else if(ev.key==="Escape"){clearGrid();input.remove();}
  });
});

function clearGrid(){
  cells.forEach(c=>c.textContent="");
  setActive(0);
  results.textContent="Ruudukko tyhjennetty.";
}
document.getElementById("clearBtn").onclick=clearGrid;
document.getElementById("searchBtn").onclick=findMatchesSmart;

// Hakutoiminto
function findMatchesSmart(){
  const pattern=cells.map(c=>{
    const t=(c.textContent||"").trim().toUpperCase();
    if(t===".")return".";
    if(t==="")return"_";
    return t;
  });
  const maxLen=pattern.length;
  const dotIdx=pattern.indexOf(".");
  const matches=[];
  if(dotIdx!==-1){
    const cut=pattern.slice(0,dotIdx);
    const model=cut.map(ch=>ch==="_"?".":ch).join("");
    const re=new RegExp("^"+model+"$","i");
    const plen=cut.length;
    for(const w of words){
      if(w.length===plen && re.test(w)) matches.push([w.toUpperCase(),0]);
    }
  } else {
    const known=[];
    for(let i=0;i<maxLen;i++){
      const ch=pattern[i];
      if(/^[A-Z√Ö√Ñ√ñ]$/.test(ch)) known.push([i,ch]);
    }
    if(!known.length){results.textContent="Sy√∂t√§ ainakin yksi kirjain.";return;}
    for(const wOrig of words){
      const w=wOrig.toUpperCase();
      const wlen=w.length;
      if(wlen>maxLen)continue;
      for(let start=0;start<=maxLen-wlen;start++){
        let fits=true;
        for(const [pos,ch] of known){
          const wi=pos-start;
          if(wi<0||wi>=wlen||w[wi]!==ch){fits=false;break;}
        }
        if(fits){matches.push([w,start]);break;}
      }
    }
  }

  if(!matches.length){results.textContent="Ei sopivia sanoja.";return;}

  let html=`<b>${matches.length}</b> sanaa l√∂ytyi:<br><br>`;
  for(const [word,start] of matches){
    let out="";
    for(let i=0;i<word.length;i++){
      const boardIndex=start+i;
      const boardCh=pattern[boardIndex];
      const wCh=word[i];
      if(boardIndex<maxLen && /^[A-Z√Ö√Ñ√ñ]$/.test(boardCh) && boardCh===wCh)
        out+=`<span class="known">${wCh}</span>`;
      else out+=wCh;
    }
    html+=out+"<br>";
  }
  results.innerHTML=html;
}
</script>
</body>
</html>
