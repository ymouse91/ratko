<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ristisanaratkoja</title>
<link rel="manifest" href="manifest.json">
<style>
:root{
  --cell: 52px;
  --gap: 6px;
  --accent: #0d6efd;
  --bg: #f9fafb;
}
body{
  font-family: system-ui, sans-serif;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  padding: 2rem;
}
h1{ margin:0; color:var(--accent); }
#grid{
  display: flex;
  gap: var(--gap);
  flex-wrap: wrap;
  justify-content: center;
  max-width: calc(var(--cell) * 15 + var(--gap) * 14);
}
.cell{
  width: var(--cell);
  height: var(--cell);
  border: 2px solid #ccc;
  display: grid;
  place-items: center;
  font-size: 1.6rem;
  text-transform: uppercase;
  background: white;
  user-select: none;
  cursor: pointer;
  transition: 0.15s;
}
.cell.active{ border-color: var(--accent); background: #eaf1ff; }
.cell.filled{ border-color: var(--accent); }
#buttons{
  display: flex;
  gap: .6rem;
  flex-wrap: wrap;
  justify-content: center;
}
button{
  padding: .6rem 1.2rem;
  background: var(--accent);
  border: none;
  border-radius: 6px;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
button:hover{ opacity: 0.9; }
#results{
  width: 90%;
  max-width: 400px;
  background: white;
  border-radius: 8px;
  padding: 1rem;
  box-shadow: 0 2px 8px rgba(0,0,0,.1);
  font-family: monospace;
  white-space: pre;
}
kbd{
  background:#eee;
  border-radius:3px;
  padding:0 4px;
  border:1px solid #ccc;
}
</style>
</head>
<body>

<h1>Ristisanaratkoja</h1>
<div id="grid"></div>

<div id="buttons">
  <button id="searchBtn">üîç Etsi sanat (Enter)</button>
  <button id="clearBtn">üßπ Tyhjenn√§ (Esc)</button>
</div>

<pre id="results">Ladataan sanalistaa...</pre>

<script>
// ================== 1. Lataa sanalista ==================
let words = [];
fetch('suodatetut.txt')
  .then(r => r.text())
  .then(t => {
    words = t.split(/\r?\n/).map(w => w.trim()).filter(Boolean);
    results.textContent = 'Valmis! Sy√∂t√§ kirjaimia ruudukkoon ja paina Enter.';
  });

// ================== 2. Luo 15 ruutua ==================
const grid = document.getElementById('grid');
const CELLS = 15;
const cells = [];
for(let i=0;i<CELLS;i++){
  const d = document.createElement('div');
  d.className = 'cell';
  d.dataset.index = i;
  grid.appendChild(d);
  cells.push(d);
}

// ================== 3. Aktiivisen ruudun hallinta ==================
let active = 0;
function setActive(i){
  if(i<0 || i>=CELLS) return;
  cells[active]?.classList.remove('active');
  active = i;
  cells[active].classList.add('active');
}
setActive(0);

cells.forEach((cell,i)=>{
  cell.addEventListener('click',()=>setActive(i));
});

// ================== 4. Kirjainten sy√∂tt√∂ ==================
document.addEventListener('keydown', e=>{
  const c = e.key;
  if(c.length===1 && /[a-z√•√§√∂]/i.test(c)){
    cells[active].textContent = c.toUpperCase();
    cells[active].classList.add('filled');
    setActive(Math.min(active+1, CELLS-1));
  } else if(c===' '){
    cells[active].textContent = '';
    cells[active].classList.remove('filled');
    setActive(Math.min(active+1, CELLS-1));
  } else if(c==='.'){
    cells[active].textContent='.';
    cells[active].classList.add('filled');
  } else if(c==='Backspace'){
    cells[active].textContent='';
    cells[active].classList.remove('filled');
    setActive(Math.max(active-1,0));
  } else if(c==='ArrowRight') setActive(Math.min(active+1, CELLS-1));
  else if(c==='ArrowLeft') setActive(Math.max(active-1,0));
  else if(c==='Enter') findMatches();
  else if(c==='Escape') clearGrid();
});

// ================== 5. Tyhjennys ==================
function clearGrid(){
  cells.forEach(c=>{
    c.textContent='';
    c.classList.remove('filled','active');
  });
  setActive(0);
  results.textContent='Ruudukko tyhjennetty.';
}
document.getElementById('clearBtn').addEventListener('click', clearGrid);

// ================== 6. Mallin muodostus ja haku ==================
const results = document.getElementById('results');

function buildPattern(){
  let pattern='';
  for(let c of cells){
    const ch = c.textContent.trim();
    if(ch==='.'){ break; }
    pattern += (ch==='' ? '.' : ch);
  }
  return pattern.toLowerCase();
}

function findMatches(){
  const pat = buildPattern();
  if(!pat){
    results.textContent='Anna v√§hint√§√§n yksi kirjain.';
    return;
  }
  const re = new RegExp('^' + pat.replace(/\./g,'.') + '$');
  const matches = words.filter(w => w.length===pat.length && re.test(w));
  results.textContent = matches.length ? matches.join('\n') : 'Ei osumia.';
}

document.getElementById('searchBtn').addEventListener('click', findMatches);
</script>
</body>
</html>
